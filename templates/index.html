<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <meta charset="UTF-8">
    <title>Terraform_toy!</title>
    <link rel="stylesheet" href="/static/style.css">
    <script type="text/javascript" src="/static/radicals.js"></script>

<style type="text/css">
	h4 {font-family: sans-serif;}
	p {font-family: sans-serif;}
	a {font-family: sans-serif; color:#d15423; text-decoration:none;}
</style>


</head>

<body>
    {% include "header.html" %}
    <hr />
    <table border='1'>
        <tr>

            <td valign="top" align="right">
                <!-- <button onClick='getType("NILL")'>NILL</button><br /> -->
                <button onClick='getType("TOP")'>TOP</button><br />
                <button onClick='getType("LEFT")'>LEFT</button><br />
                <button onClick='getType("BOTTOM")'>BOTTOM</button><br />
                <button onClick='getType("LEFT_TOP_RIGHT")'>LEFT_TOP_RIGHT</button><br />
                <button onClick='getType("RIGHT")'>RIGHT</button><br />
                <button onClick='getType("LEFT_BOTTOM_RIGHT")'>LEFT_BOTTOM_RIGHT</button><br />
                <button onClick='getType("TOP_RIGHT")'>TOP_RIGHT</button><br />
                <button onClick='getType("LEFT_TOP_BOTTOM")'>LEFT_TOP_BOTTOM</button><br />
                <button onClick='getType("LEFT_TOP")'>LEFT_TOP</button><br />
                <button onClick='getType("ALL")'>ALL</button><br />
                <button onClick='getType("LEFT_BOTTOM")'>LEFT_BOTTOM</button><br />
                <button onClick='getType("TOP_LEFT")'>TOP_LEFT</button><br />
                <button onClick='getType("UPPERLEFT_CENTER_BOTTOMRIGHT")'>UPPERLEFT_CENTER_BOTTOMRIGHT</button><br />
                <button onClick='getType("LEFT_RIGHT")'>LEFT_RIGHT</button>
            </td>
            <td valign="top">
                <canvas id="canvas" width="400" height="400"></canvas>

            </td>

        </tr>
    </table>
    <hr />


    <script>
class Thing {
    constructor(x, y) {
        this.x = x
        this.y = y
    }
} 


    </script>



    <script>

        


const canvas = document.getElementById('canvas');
const  ctx =  canvas.getContext('2d');
let screenRect;

const things = [] 
var WIDTH = 100, HEIGHT = 50;
// var prevMouseX, prevMouseY;
var isMouseDown = false;
const NILL = -1
let active = 0

function init() {
    screenRect = canvas.getBoundingClientRect();

    things.push( new Thing(canvas.width / 2, canvas.height / 2 ))
    things.push( new Thing(50, 50 ))

    addKeyEventListener();

    animate();
}

function addKeyEventListener() {

    canvas.onmousedown = function(e) {
        var x = event.clientX - screenRect.left;
        var y = event.clientY - screenRect.top;

        prevMouseX = x;
        prevMouseY = y;

        isMouseDown = true;
    }

    canvas.onmousemove = function(e) {
        if(isMouseDown && active !== NILL) {
            const x = event.clientX - screenRect.left;
            const y = event.clientY - screenRect.top;

            let horizon = 300
            let actual = 10000000;
            let found = NILL 
            things.forEach((thing, i )=> { 
                const d  = Math.sqrt((thing.x - x) * (thing.x - x) + (thing.y - y) * (thing.y - y));
                console.log( i + "    " + x + "   y " + y + "   " + d )
                if ( d < actual && d < horizon ) {
                    actual = d 
                    found = i 
                }
            })
            if ( found !== NILL ) {
                active = found 
                const dx = x - prevMouseX;
                const dy = y - prevMouseY;
                things[active].x += dx
                things[active].y += dy
                prevMouseX = x;
                prevMouseY = y;
            }
        }
    }

    canvas.onmouseup = function(e) {
        var x = event.clientX - screenRect.left;
        var y = event.clientY - screenRect.top;
        isMouseDown = false;
        isRectSelected = false;
    }

    canvas.onmouseout = function(e) {
        isMouseDown = false;
    }
}

function animate() {
    drawCanvasBackground();
    drawRect();

    requestAnimationFrame(function() {
        animate();
    });
}

function drawCanvasBackground() {
    ctx.fillStyle = 'white';
    ctx.strokeStyle = 'black';

    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.rect(0, 0, canvas.width, canvas.height);
    ctx.stroke();
}

function drawRect() {
    ctx.strokeStyle = 'black';
    things.forEach((thing)=> { 
        ctx.beginPath();
        ctx.rect(thing.x - WIDTH / 2, thing.y - HEIGHT / 2, WIDTH, HEIGHT);
        ctx.stroke();


    })
    // ctx.beginPath();
    // ctx.rect(rectX[0] - WIDTH / 2, rectY[0] - HEIGHT / 2, WIDTH, HEIGHT);
    // ctx.stroke();
}



init()
    </script>

</body>

</html>